<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ENG microsites on local</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>Active Microsites</h1>

  <table id="micrositeListTable" class="table table-striped table-bordered">
  <thead>
    <th><i class="icon-th"></i></th>
    <th><i class="icon-star"></i>&nbsp;Site Name</th>
    <th><i class="icon-calendar"></i>&nbsp;Date</th>
    <th><i class="icon-edit"></i>&nbsp;Preview</th>
    <th><i class="icon-check"></i>&nbsp;Published</th>
  </thead>
  <tbody>
  </tbody>
  </table>

  <h1>Retired Microsites</h1>

  <table id="micrositeListTableRetired" class="table table-striped table-bordered retired">
  <thead>
    <th><i class="icon-th"></i></th>
    <th><i class="icon-star"></i>&nbsp;Site Name</th>
    <th><i class="icon-calendar"></i>&nbsp;Date</th>
    <th><i class="icon-edit"></i>&nbsp;Preview</th>
    <th><i class="icon-check"></i>&nbsp;Published</th>
  </thead>
  <tbody>
  </tbody>
  </table>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script>

    $(document).on('ready', function() {

      // for now using a symlink to actual json file...
      function getMicrositeList( ) {
        return $.getJSON('micrositeListClone.json').pipe(function (data) {
          return data.sites;
        });
      }

      var list = getMicrositeList();
      var arr = [];
      var rows = '';
      var rowsRetired = '';
      var num = 0;
      var numRetired = 0;
      var created;
      var ifEmbedded = '';

      list.done(function (items) {

        // get array of site names
        for (var site in items) {
          arr.push(site);
        }

        arr.sort();

        // iterrate through json and build table rows
        for (var i = 0, len = arr.length; i < len; i++) {

          // filter out "inactive" sites
          if (items[ arr[i] ].isActive) {

            ifEmbedded = (items[ arr[i] ].isEmbedded) ? 'embedded.html' : 'index.html';

            created = new Date(items[ arr[i] ].added);

            rows += '<tr>' +
                    '<td>' + (num+1) + '</td>' +
                    '<td><a href="/sites/' + items[ arr[i] ].foldername + '/' + ifEmbedded + '">' + arr[i] + '</a></td>' +
                    '<td>' + created.getFullYear() + '.' + (created.getMonth() + 1) + '.' + (created.getDate() + 1) + '</td>' +
                    '<td><a href="' + items[ arr[i] ].urlPreview + '">' + items[ arr[i] ].urlPreview + '</a></td>' +
                    '<td><a href="' + items[ arr[i] ].url + '">' + items[ arr[i] ].url + '</a></td>' +
                    '</tr>';

            num++;

          } else {


            ifEmbedded = (items[ arr[i] ].isEmbedded) ? 'embedded.html' : 'index.html';

            created = new Date(items[ arr[i] ].added);

            rowsRetired += '<tr>' +
                    '<td>' + (numRetired+1) + '</td>' +
                    '<td><a href="/sites/' + items[ arr[i] ].foldername + '/' + ifEmbedded + '">' + arr[i] + '</a></td>' +
                    '<td>' + created.getFullYear() + '.' + (created.getMonth() + 1) + '.' + (created.getDate() + 1) + '</td>' +
                    '<td><a href="' + items[ arr[i] ].urlPreview + '">' + items[ arr[i] ].urlPreview + '</a></td>' +
                    '<td><a href="' + items[ arr[i] ].url + '">' + items[ arr[i] ].url + '</a></td>' +
                    '</tr>';

            numRetired++;

          }

        }

        $('#micrositeListTable').append(rows);

        $('#micrositeListTableRetired').append(rowsRetired);

        $('#micrositeListTable, #micrositeListTableRetired').on('click', 'td', function (e) {
          e.preventDefault();
          window.open( $(this).children('a').attr('href') );
        });

      });

    });

  </script>

</body>
</html>